<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ISDS Supply - Regístrate</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#f7fbff;
      --bg1:#eef8ff;
      --card:#ffffffcc;
      --border:rgba(6,26,45,.12);
      --text:#0b1b2a;
      --muted:#5b6672;

      /* ==== PALETA ISDS (TURQUESA) ==== */
      --teal:#1EA6B2;
      --teal2:#2CC0C6;
      --teal3:#167B86;

      --accent:#1EA6B2;
      --accent2:#63D3FF;

      --shadow: 0 24px 60px rgba(0,0,0,.14);
      --shadow-soft: 0 12px 30px rgba(6,26,45,.12);

      --r-lg: 22px;
      --r-md: 14px;
      --ease: cubic-bezier(.22,1,.36,1);

      --maxw: 30rem;
    }

    *{ margin:0; padding:0; box-sizing:border-box; }
    html,body{ width:100%; height:100%; }

    body{
      font-family:'Open Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      line-height:1.6;
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(30,166,178,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 30%, rgba(44,192,198,.14), transparent 55%),
        linear-gradient(135deg,var(--bg0) 0%, var(--bg1) 100%);
      overflow-x:hidden;
    }

    /* Subtle grid */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(to right, rgba(6,26,45,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(6,26,45,.05) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(circle at 30% 20%, rgba(0,0,0,.85), rgba(0,0,0,.12) 55%, transparent 72%);
      opacity:.35;
      z-index:0;
    }

    .container{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding: clamp(16px, 4vw, 28px);
      position:relative;
      overflow:hidden;
    }

    /* Animated background blobs */
    .bg-accent{
      position:fixed;
      inset:-20%;
      opacity:1;
      pointer-events:none;
      z-index:0;
      filter: blur(40px);
    }
    .bg-accent::before,
    .bg-accent::after{
      content:"";
      position:absolute;
      width:min(520px, 70vw);
      height:min(520px, 70vw);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(30,166,178,.50), rgba(30,166,178,.05) 70%, transparent 72%);
      transform: translate3d(0,0,0);
      animation: floatBlob 10s var(--ease) infinite;
      will-change: transform;
    }
    .bg-accent::before{ top: 2%; left: 6%; }
    .bg-accent::after{
      bottom: 0%;
      right: 2%;
      background: radial-gradient(circle at 30% 30%, rgba(22,123,134,.55), rgba(22,123,134,.08) 70%, transparent 72%);
      animation-duration: 12s;
      animation-direction: reverse;
    }

    @keyframes floatBlob{
      0%{ transform: translate3d(0,0,0) scale(1); }
      40%{ transform: translate3d(30px, -25px, 0) scale(1.05); }
      70%{ transform: translate3d(-18px, 18px, 0) scale(.98); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    .card{
      width:100%;
      max-width:var(--maxw);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      box-shadow: var(--shadow);
      position:relative;
      z-index:10;
      overflow:hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transform: translateY(12px);
      opacity:0;
      animation: cardIn .8s var(--ease) forwards, floatCard 6s ease-in-out 900ms infinite;
    }

    @keyframes cardIn{ to{ transform: translateY(0); opacity:1; } }

    .header{
      background:
        radial-gradient(900px 300px at 15% 0%, rgba(44,192,198,.30), transparent 55%),
        linear-gradient(135deg, var(--teal3) 0%, var(--teal) 55%, var(--teal2) 100%);
      padding: 22px 22px 20px;
      text-align:center;
      position:relative;
      overflow:hidden;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .header::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,.12), transparent 35%),
        radial-gradient(circle at 80% 0%, rgba(255,255,255,.10), transparent 40%),
        radial-gradient(circle at 50% 120%, rgba(255,255,255,.10), transparent 45%);
      opacity:.75;
      pointer-events:none;
    }

    .company-name{
      color: rgba(255,255,255,.92);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .22em;
      text-transform: uppercase;
      margin-bottom: 10px;
      position:relative;
      z-index:2;
    }

    .header h1{
      color:white;
      font-size: clamp(1.45rem, 3.6vw, 1.95rem);
      font-weight: 700;
      font-family: 'Montserrat', system-ui, sans-serif;
      letter-spacing: -0.01em;
      margin-bottom: 6px;
      position:relative;
      z-index:2;
    }
    .header p{
      color: rgba(255,255,255,.86);
      font-size: .92rem;
      font-weight: 600;
      position:relative;
      z-index:2;
    }

    .form-section{ padding: 22px; }
    .form-group{ margin-bottom: 14px; }

    .form-group label{
      display:block;
      font-size: .86rem;
      font-weight: 700;
      color: rgba(11,27,42,.92);
      margin-bottom: 8px;
    }

    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group select{
      width:100%;
      height: 52px;
      padding: 0 14px;
      border: 1px solid rgba(6,26,45,.12);
      border-radius: 14px;
      font-size: 1rem;
      color: var(--text);
      background: rgba(255,255,255,.85);
      transition: transform .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease), background .18s var(--ease);
      box-shadow: 0 2px 0 rgba(6,26,45,.03);
    }

    .form-group input::placeholder{ color: rgba(91,102,114,.75); }

    .form-group input:hover,
    .form-group select:hover{
      border-color: rgba(30,166,178,.45);
      box-shadow: 0 10px 28px rgba(6,26,45,.08);
      transform: translateY(-1px);
      background: rgba(255,255,255,.95);
    }

    .form-group input:focus,
    .form-group select:focus{
      outline:none;
      border-color: rgba(30,166,178,.85);
      box-shadow: 0 0 0 4px rgba(30,166,178,.18), 0 14px 40px rgba(6,26,45,.12);
      transform: translateY(-1px);
      background: #fff;
    }

    .error-message{
      background: rgba(255, 59, 59, 0.08);
      border: 1px solid rgba(255, 59, 59, 0.18);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: .9rem;
      color: #b42318;
      margin-bottom: 14px;
      animation: popIn .35s var(--ease);
    }

    @keyframes popIn{
      from{ opacity:0; transform: translateY(-6px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .submit-btn{
      width:100%;
      height: 54px;
      border: none;
      border-radius: 16px;
      font-weight: 800;
      font-size: 1rem;
      letter-spacing: .06em;
      text-transform: uppercase;
      cursor:pointer;
      color:white;
      background:
        radial-gradient(160px 120px at 20% 10%, rgba(44,192,198,.55), transparent 55%),
        linear-gradient(135deg, var(--teal3) 0%, var(--teal) 55%, var(--teal2) 100%);
      box-shadow: 0 18px 40px rgba(22,123,134,.26);
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), filter .18s var(--ease);
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
    }

    .submit-btn::before{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent);
      transform: translateX(-30%);
      opacity:.0;
    }

    .submit-btn:hover:not(:disabled){
      transform: translateY(-2px);
      box-shadow: 0 24px 60px rgba(22,123,134,.34);
      filter: saturate(1.05);
    }
    .submit-btn:hover:not(:disabled)::before{
      opacity:1;
      animation: shimmer 1.2s var(--ease) infinite;
    }

    @keyframes floatCard{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-10px); }
    }

    @keyframes shimmer{
      0%{ transform: translateX(-40%); }
      100%{ transform: translateX(40%); }
    }

    .submit-btn:active:not(:disabled){ transform: translateY(0) scale(.98); }
    .submit-btn:disabled{ opacity:.65; cursor:not-allowed; box-shadow: var(--shadow-soft); }

    .spinner{
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,.85);
      border-top-color: transparent;
      border-radius: 999px;
      animation: spin .7s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    .footer{
      padding: 16px 22px 18px;
      border-top: 1px solid rgba(6,26,45,.08);
      background: rgba(255,255,255,.55);
    }
    .footer p{
      font-size: .78rem;
      color: rgba(91,102,114,.9);
      text-align:center;
    }

    .footer-info{
      margin-top: 18px;
      text-align:center;
      z-index:10;
    }
    .footer-info p{
      font-size: .78rem;
      color: rgba(91,102,114,.92);
      margin: 3px 0;
    }
    .footer-info .company{
      font-weight: 800;
      color: var(--teal3);
      letter-spacing: .18em;
      text-transform: uppercase;
    }

    /* Success state */
    .success-container{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(16px, 4vw, 28px);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(30,166,178,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 30%, rgba(44,192,198,.14), transparent 55%),
        linear-gradient(135deg,var(--bg0) 0%, var(--bg1) 100%);
    }
    .success-card{
      width:100%;
      max-width:var(--maxw);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      box-shadow: var(--shadow);
      padding: 26px;
      text-align:center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      animation: cardIn .55s var(--ease) forwards, floatCard 6s ease-in-out 900ms infinite;
    }

    .success-icon{
      width: 78px;
      height: 78px;
      margin: 0 auto 16px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(30,166,178,.14);
      border: 1px solid rgba(30,166,178,.22);
      box-shadow: 0 18px 40px rgba(6,26,45,.14);
      animation: bounceIn .6s var(--ease);
    }
    @keyframes bounceIn{
      0%{ transform: scale(.6); opacity:0; }
      60%{ transform: scale(1.04); opacity:1; }
      100%{ transform: scale(1); }
    }
    .success-icon svg{
      width: 38px;
      height: 38px;
      color: var(--teal3);
    }

    .success-card h2{
      font-size: 1.55rem;
      font-weight: 800;
      font-family:'Montserrat',system-ui,sans-serif;
      margin-bottom: 10px;
    }
    .success-card p{
      color: rgba(91,102,114,.95);
      margin-bottom: 14px;
      font-size: .98rem;
    }

    .success-data{
      background: rgba(6,26,45,.04);
      border: 1px solid rgba(6,26,45,.10);
      border-radius: 16px;
      padding: 14px;
      margin: 14px 0 16px;
      text-align:left;
    }
    .success-data p{
      font-size: .9rem;
      margin: 6px 0;
      color: rgba(91,102,114,.95);
    }
    .success-data p:first-child{
      font-weight: 800;
      color: rgba(11,27,42,.95);
      margin-bottom: 10px;
    }

    /* Reveal animation (staggered) */
    .reveal{
      opacity:0;
      transform: translateY(10px);
      transition: opacity .5s var(--ease), transform .5s var(--ease);
      will-change: opacity, transform;
    }
    .reveal.in{ opacity:1; transform: translateY(0); }

    @media (max-width: 640px){
      .card{ border-radius: 18px; }
      .header{ padding: 24px 18px 18px; }
      .form-section{ padding: 18px; }
      .footer{ padding: 14px 18px 16px; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
      .bg-accent{ display:none; }
    }

    .hidden{ display:none; }

    /* ===== Logo superior (imagen) ===== */
    .brand-logo-wrap{
      display:flex;
      justify-content:center;
      align-items:center;
      margin: 2px auto 14px;
      position:relative;
      z-index:3;
    }
    .brand-logo{
      width: min(360px, 86%);
      height: auto;
      display:block;
      border-radius: 14px;
      box-shadow: 0 18px 44px rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      transform: translateY(-2px);
    }

    @media (max-width: 420px){
      .brand-logo{ width: min(320px, 92%); border-radius: 12px; }
      .brand-logo-wrap{ margin-bottom: 12px; }
    }
  </style>
</head>

<body>
<div id="app">
  <div class="container">
    <div class="bg-accent"></div>

    <div class="card">
      <div class="header">
        <div class="brand-logo-wrap">
          <!-- LOGO ISDS -->
          <img class="brand-logo" src="ISDSLOGO.jpeg" alt="ISDS Supply">
        </div>

        <div class="company-name">ISDS SUPPLY</div>
        <h1>Regístrate</h1>
        <p>Insumos y atención personalizada</p>
      </div>

      <form id="registrationForm" class="form-section">
        <div id="errorContainer"></div>

        <input type="hidden" name="vendedor" id="vendedor">

        <div class="form-group">
          <label for="nombre">Nombre completo *</label>
          <input type="text" id="nombre" name="nombre" placeholder="Tu nombre" required>
        </div>

        <div class="form-group">
          <label for="cargo">Cargo *</label>
          <input type="text" id="cargo" name="cargo" placeholder="Ej: Administrador / Chef / Dueño" required>
        </div>

        <div class="form-group">
          <label for="empresa_cliente">Empresa / Negocio *</label>
          <input type="text" id="empresa_cliente" name="empresa_cliente" placeholder="Tu empresa" required>
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" placeholder="tu@email.com" required>
        </div>

        <div class="form-group">
          <label for="telefono">Teléfono *</label>
          <input type="tel" id="telefono" name="telefono" placeholder="+507 XXXX-XXXX" required>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          Registrarme
        </button>
      </form>

      <div class="footer">
        <p>Tus datos están protegidos y no serán compartidos. Solo los usaremos para contactarte y enviarte información.</p>
      </div>
    </div>

    <div class="footer-info">
      <p class="company">ISDS SUPPLY</p>
      <p>Entregas rápidas • Importación • Atención personalizada</p>
    </div>

  </div>
</div>

<script>
  // ===== Util =====
  function getParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param) || '';
  }

  // JSONP helper (para GitHub Pages)
  function jsonp(url) {
    return new Promise((resolve, reject) => {
      const cbName = "cb_" + Math.random().toString(36).slice(2);
      const script = document.createElement("script");

      window[cbName] = (data) => {
        try { delete window[cbName]; } catch (_) {}
        script.remove();
        resolve(data);
      };

      script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cbName;
      script.onerror = () => {
        try { delete window[cbName]; } catch (_) {}
        script.remove();
        reject(new Error("No se pudo conectar."));
      };

      document.body.appendChild(script);
    });
  }

  // ===== Parámetros =====
  const EMPRESA_ID = (getParam('empresa_id') || 'isds').trim();
  const EMPRESA = getParam('empresa') || 'ISDS Supply';
  const VENDEDOR_PARAM = getParam('vendedor') || 'Desconocido';

  // ===== DOM =====
  const form = document.getElementById('registrationForm');
  const submitBtn = document.getElementById('submitBtn');
  const errorContainer = document.getElementById('errorContainer');
  const appContainer = document.getElementById('app');

  document.addEventListener('DOMContentLoaded', function() {
    const v = document.getElementById('vendedor');
    if (v) v.value = VENDEDOR_PARAM;

    const items = document.querySelectorAll('.card .header, .card .form-section .form-group, .card .form-section .submit-btn, .card .footer, .footer-info');
    items.forEach((el, i) => {
      el.classList.add('reveal');
      el.style.transitionDelay = `${Math.min(i * 70, 520)}ms`;
    });

    const io = new IntersectionObserver((entries) => {
      for (const e of entries) {
        if (e.isIntersecting) {
          e.target.classList.add('in');
          io.unobserve(e.target);
        }
      }
    }, { threshold: 0.12 });

    items.forEach(el => io.observe(el));
  });

  // ===== API (MISMO ENDPOINT QUE YA USAS) =====
  const API_BASE = 'https://script.google.com/macros/s/AKfycbx7ghGSC47jyKY5ArI2s1JpO3UILEHVzmfaHxYxG3sLYfN3QDyFYWnXFStRLHvdJGtXRQ/exec';

  function showError(message) {
    errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
  }

  function showSuccess(nombre, email, empresa_cliente, telefono, cargo) {
    const successHTML = `
      <div class="success-container">
        <div class="success-card">
          <div class="success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h2>¡Gracias por registrarte!</h2>
          <p>Hemos recibido tu información. Te contactaremos pronto.</p>

          <div class="success-data">
            <p>Datos registrados:</p>
            <p><strong>Nombre:</strong> ${nombre}</p>
            <p><strong>Cargo:</strong> ${cargo}</p>
            <p><strong>Empresa:</strong> ${empresa_cliente}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Teléfono:</strong> ${telefono}</p>
          </div>

          <p style="font-size: 0.875rem; color: #6b6b6b;">Puedes cerrar esta ventana o escanear otro código QR.</p>
        </div>
      </div>
    `;
    appContainer.innerHTML = successHTML;

    setTimeout(() => {
      location.reload();
    }, 4000);
  }

  // ===== Submit (MISMA LÓGICA) =====
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorContainer.innerHTML = '';
    submitBtn.disabled = true;

    const nombre = document.getElementById('nombre').value.trim();
    const cargo = document.getElementById('cargo').value.trim();
    const empresa_cliente = document.getElementById('empresa_cliente').value.trim();
    const email = document.getElementById('email').value.trim();
    const telefono = document.getElementById('telefono').value.trim();
    const vendedor = (document.getElementById('vendedor')?.value || VENDEDOR_PARAM).trim();

    if (!nombre || !cargo || !empresa_cliente || !email || !telefono) {
      showError('Por favor completa todos los campos requeridos.');
      submitBtn.disabled = false;
      return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showError('Por favor ingresa un email válido.');
      submitBtn.disabled = false;
      return;
    }

    submitBtn.innerHTML = '<div class="spinner"></div> Enviando...';

    try {
      const qs = new URLSearchParams();
      qs.set('action', 'contacts_create');
      qs.set('empresa_id', EMPRESA_ID);
      qs.set('empresa', EMPRESA);
      qs.set('vendedor', vendedor);

      qs.set('nombre', nombre);
      qs.set('cargo', cargo);                 // NUEVO CAMPO
      qs.set('empresa_cliente', empresa_cliente);
      qs.set('email', email);
      qs.set('telefono', telefono);
      qs.set('fecha', new Date().toISOString());

      const url = `${API_BASE}?${qs.toString()}`;
      const data = await jsonp(url);

      if (!data || data.ok !== true) {
        throw new Error((data && data.message) ? data.message : 'No se pudo procesar tu solicitud.');
      }

      await new Promise(r => setTimeout(r, 700));
      showSuccess(nombre, email, empresa_cliente, telefono, cargo);

    } catch (error) {
      console.error('Error:', error);
      showError(String(error && error.message ? error.message : 'Error al procesar tu solicitud. Por favor intenta de nuevo.'));
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Registrarme';
    }
  });
</script>

</body>
</html>
