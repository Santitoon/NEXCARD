<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NEXCARD • Acceso empresas</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#f7fbff;
      --bg1:#eef4ff;
      --card:rgba(255,255,255,.72);
      --border:rgba(6,26,45,.12);
      --text:#0b1b2a;
      --muted:#5b6672;

      --navy:#061A2D;
      --navy2:#0A2A4A;
      --navy3:#0F3B6A;

      --accent:#21A1FF;
      --accent2:#63D3FF;

      --shadow: 0 24px 70px rgba(0,0,0,.16);
      --shadow-soft: 0 12px 28px rgba(6,26,45,.12);

      --r-lg: 22px;
      --r-md: 14px;
      --ease: cubic-bezier(.22,1,.36,1);
      --maxw: 30rem;
    }

    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:'Open Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(33,161,255,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 30%, rgba(99,211,255,.14), transparent 55%),
        linear-gradient(135deg,var(--bg0) 0%, var(--bg1) 100%);
      overflow:hidden;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(to right, rgba(6,26,45,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(6,26,45,.05) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(circle at 30% 20%, rgba(0,0,0,.85), rgba(0,0,0,.12) 55%, transparent 72%);
      opacity:.35;
      z-index:0;
    }

    .bg-accent{
      position:fixed; inset:-20%;
      pointer-events:none; z-index:0;
      filter: blur(42px);
    }
    .bg-accent::before,.bg-accent::after{
      content:"";
      position:absolute;
      width:min(560px, 72vw);
      height:min(560px, 72vw);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(33,161,255,.52), rgba(33,161,255,.05) 70%, transparent 72%);
      animation: floatBlob 10s var(--ease) infinite;
    }
    .bg-accent::before{top: 1%; left: 6%;}
    .bg-accent::after{
      bottom: -2%; right: 2%;
      background: radial-gradient(circle at 30% 30%, rgba(15,59,106,.58), rgba(15,59,106,.08) 70%, transparent 72%);
      animation-duration: 12s; animation-direction: reverse;
    }
    @keyframes floatBlob{
      0%{ transform: translate3d(0,0,0) scale(1); }
      40%{ transform: translate3d(30px, -25px, 0) scale(1.05); }
      70%{ transform: translate3d(-18px, 18px, 0) scale(.98); }
      100%{ transform: translate3d(0,0,0) scale(1); }
    }

    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px;
      position:relative;
      z-index:2;
    }

    .window{
      width:100%;
      max-width: 980px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 18px;
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      animation: in .7s var(--ease) forwards;
    }
    @keyframes in { to{ transform: translateY(0); opacity:1; } }

    .left{
      padding: 22px;
      background:
        radial-gradient(900px 340px at 20% 0%, rgba(33,161,255,.28), transparent 55%),
        linear-gradient(135deg, var(--navy) 0%, var(--navy2) 55%, var(--navy3) 100%);
      position:relative;
      border-right: 1px solid rgba(255,255,255,.12);
    }
    .left::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 20% 15%, rgba(255,255,255,.12), transparent 35%),
        radial-gradient(circle at 90% 0%, rgba(255,255,255,.10), transparent 40%),
        radial-gradient(circle at 55% 120%, rgba(255,255,255,.10), transparent 45%);
      opacity:.85;
      pointer-events:none;
    }

    .brand{
      position:relative;
      z-index:2;
      display:flex; align-items:center; gap:12px;
      margin-bottom: 16px;
    }
    .mark{
      width:46px; height:46px;
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
      position:relative;
      overflow:hidden;
    }
    .mark::after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg, rgba(33,161,255,0), rgba(33,161,255,.35), rgba(255,255,255,0));
      animation: spin 5s linear infinite;
      opacity:.8;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    .brand h1{
      font-family:'Montserrat',system-ui,sans-serif;
      font-size: 20px;
      color:white;
      letter-spacing:-.02em;
    }
    .brand p{
      color: rgba(255,255,255,.82);
      font-weight:700;
      font-size: 13px;
      margin-top:4px;
    }

    .steps{
      position:relative;
      z-index:2;
      margin-top: 12px;
      display:grid;
      gap: 12px;
    }
    .step{
      display:flex; gap: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .bubble{
      width:34px; height:34px;
      border-radius: 14px;
      background: rgba(33,161,255,.18);
      border: 1px solid rgba(255,255,255,.16);
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.9);
      font-weight:900;
    }
    .step b{color:white; font-family:'Montserrat',system-ui,sans-serif}
    .step small{display:block; color: rgba(255,255,255,.80); font-weight:650; margin-top:3px}

    .right{
      padding: 22px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 12px;
    }

    .panel{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
      padding: 18px;
    }

    .panel h2{
      font-family:'Montserrat',system-ui,sans-serif;
      font-size: 20px;
      letter-spacing:-.02em;
      margin-bottom: 6px;
    }
    .panel .hint{
      color: var(--muted);
      font-weight:700;
      font-size: 13px;
      margin-bottom: 14px;
    }

    label{
      display:block;
      font-size: 12px;
      font-weight:900;
      color: rgba(11,27,42,.82);
      margin: 10px 0 6px;
      letter-spacing:.06em;
      text-transform: uppercase;
    }
    .in{
      width:100%;
      height: 48px;
      padding: 0 14px;
      border: 1px solid rgba(6,26,45,.12);
      border-radius: 14px;
      font-size: 15px;
      font-weight: 650;
      background: rgba(255,255,255,.88);
      transition: transform .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease);
    }
    .in:focus{
      outline:none;
      border-color: rgba(33,161,255,.85);
      box-shadow: 0 0 0 4px rgba(33,161,255,.18), 0 14px 40px rgba(6,26,45,.12);
      transform: translateY(-1px);
      background: #fff;
    }

    .row{display:flex; gap: 10px; align-items:center; margin-top: 14px}
    .btn{
      height: 50px;
      border: none;
      border-radius: 16px;
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      cursor:pointer;
      padding: 0 14px;
      display:flex; align-items:center; justify-content:center; gap: 10px;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), filter .18s var(--ease);
      user-select:none;
    }
    .btn-primary{
      flex:1;
      color:white;
      background:
        radial-gradient(160px 120px at 20% 10%, rgba(99,211,255,.55), transparent 55%),
        linear-gradient(135deg, var(--navy) 0%, var(--navy2) 55%, var(--navy3) 100%);
      box-shadow: 0 18px 40px rgba(6,26,45,.26);
    }
    .btn-primary:hover{transform: translateY(-1px); box-shadow: 0 24px 60px rgba(6,26,45,.34); filter:saturate(1.05)}
    .btn-ghost{
      width: 120px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(6,26,45,.12);
      color: var(--navy2);
      box-shadow: var(--shadow-soft);
    }

    .spinner{
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,.9);
      border-top-color: transparent;
      border-radius: 999px;
      animation: spin2 .7s linear infinite;
    }
    @keyframes spin2{ to{ transform: rotate(360deg); } }

    .err{
      display:none;
      background: rgba(255, 59, 59, 0.08);
      border: 1px solid rgba(255, 59, 59, 0.18);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
      color: #b42318;
      font-weight: 700;
      margin-top: 12px;
      animation: pop .35s var(--ease);
    }
    @keyframes pop{ from{opacity:0; transform: translateY(-6px) scale(.98)} to{opacity:1; transform: translateY(0) scale(1)} }

    .fine{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(91,102,114,.92);
      font-weight: 650;
      line-height: 1.45;
    }

    @media (max-width: 920px){
      .window{grid-template-columns: 1fr;}
      .left{border-right:none; border-bottom: 1px solid rgba(255,255,255,.12)}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important;}
      .bg-accent{display:none;}
    }
  </style>
</head>

<body>
  <div class="bg-accent"></div>

  <div class="wrap">
    <div class="window" role="dialog" aria-label="Acceso empresas NEXCARD">
      <section class="left">
        <div class="brand">
          <div class="mark" aria-hidden="true"></div>
          <div>
            <h1>NEXCARD</h1>
            <p>NFC + QR • Leads a Sheets</p>
          </div>
        </div>

        <div class="steps" aria-hidden="true">
          <div class="step">
            <div class="bubble">1</div>
            <div>
              <b>Inicia sesión</b>
              <small>Accede a tu panel privado</small>
            </div>
          </div>
          <div class="step">
            <div class="bubble">2</div>
            <div>
              <b>Ver leads</b>
              <small>Registros reales desde tu Google Sheet</small>
            </div>
          </div>
          <div class="step">
            <div class="bubble">3</div>
            <div>
              <b>Seguimiento</b>
              <small>Filtra, edita y borra contactos</small>
            </div>
          </div>
        </div>

        <p class="fine" style="position:relative; z-index:2; margin-top:14px; color:rgba(255,255,255,.82)">
          Tip: Si eres TRAMPA CLEAN, usa <b>empresa_id = trampaclean</b>.
        </p>
      </section>

      <section class="right">
        <div class="panel">
          <h2>Acceso empresas</h2>
          <div class="hint">Ventana flotante • diseño moderno • seguro con token</div>

          <form id="loginForm">
            <label for="email">Email</label>
            <input class="in" id="email" type="email" autocomplete="username" required>

            <label for="password">Contraseña</label>
            <input class="in" id="password" type="password" autocomplete="current-password" required>

            <label for="empresa_id">empresa_id</label>
            <input class="in" id="empresa_id" type="text" value="trampaclean" required>

            <label for="empresa_alias">Nombre visible</label>
            <input class="in" id="empresa_alias" type="text" value="TRAMPA CLEAN">

            <div class="row">
              <button class="btn btn-primary" id="btnLogin" type="submit">Entrar</button>
              <button class="btn btn-ghost" id="btnClear" type="button">Limpiar</button>
            </div>

            <div class="err" id="errBox"></div>

            <p class="fine">
              Tu sesión se guarda en este dispositivo. Si cambias de cuenta, usa “Cerrar sesión” en el dashboard.
            </p>
          </form>
        </div>
      </section>
    </div>
  </div>

  <script>
    const API_BASE = "https://script.google.com/macros/s/AKfycbx7ghGSC47jyKY5ArI2s1JpO3UILEHVzmfaHxYxG3sLYfN3QDyFYWnXFStRLHvdJGtXRQ/exec";
    const TOKEN_KEY = "nexcard_token";
    const EMPRESA_KEY = "nexcard_empresa_id";
    const ALIAS_KEY = "nexcard_empresa_alias";

    function jsonp(url){
      return new Promise((resolve, reject)=>{
        const cb = "cb_" + Math.random().toString(36).slice(2);
        const s = document.createElement("script");
        window[cb] = (data)=>{ try{delete window[cb]}catch(_){} s.remove(); resolve(data); };
        s.onerror = ()=>{ try{delete window[cb]}catch(_){} s.remove(); reject(new Error("No se pudo conectar")); };
        s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
        document.body.appendChild(s);
      });
    }

    function showErr(msg){
      const box = document.getElementById("errBox");
      box.textContent = msg;
      box.style.display = "block";
    }
    function clearErr(){
      const box = document.getElementById("errBox");
      box.textContent = "";
      box.style.display = "none";
    }

    document.getElementById("btnClear").addEventListener("click", ()=>{
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";
      clearErr();
    });

    document.getElementById("loginForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      clearErr();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const empresa_id = document.getElementById("empresa_id").value.trim().toLowerCase();
      const empresa_alias = document.getElementById("empresa_alias").value.trim() || empresa_id;

      if(!email || !password || !empresa_id){
        showErr("Completa email, contraseña y empresa_id.");
        return;
      }

      const btn = document.getElementById("btnLogin");
      const old = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Entrando…';

      try{
        const qs = new URLSearchParams({ action:"login", email, password });
        const data = await jsonp(`${API_BASE}?${qs.toString()}`);

        if(!data || data.ok !== true){
          throw new Error((data && data.message) ? data.message : "Login falló");
        }

        localStorage.setItem(TOKEN_KEY, data.token);
        localStorage.setItem(EMPRESA_KEY, empresa_id);
        localStorage.setItem(ALIAS_KEY, empresa_alias);

        location.href = `dashboard.html?empresa_id=${encodeURIComponent(empresa_id)}&empresa=${encodeURIComponent(empresa_alias)}`;
      }catch(err){
        showErr(String(err && err.message ? err.message : err));
        btn.disabled = false;
        btn.innerHTML = old;
      }
    });
  </script>
</body>
</html>
